title: "读《JavaScript高级程序设计》总结24"
date: 2016-01-05 07:41:18
description: "读《JavaScript高级程序设计 -- 第24章 最佳实践》介绍可维护性,性能,部署"
tags:
- "JavaScript"
---

## 可维护性

### 什么是可维护的代码

1. 可理解性: 其他人接手代码并理解它的意图和一般途径,无需原开发人员的完整解释.
2. 直观性: 代码的东西一看就懂,不管操作过程多么复杂
3. 可适用性: 代码以一种数据以上的变化不要求完全重写的方法撰写
4. 可扩展性: 代码架构已经考虑到未来允许对核心功能进行扩展
5. 可调试性: 当有地方出错,代码可以给足够的信息来定位错误

### 代码约定

- 可读性: 代码和缩进有关,常见大小缩进为4个空格.

1. 函数和方法:每个函数和方法都应该包含注释
2. 大段代码: 完成单个任务的多行代码应该在前面放一个描述任务的注释
3. 复杂的算法: 使用了独特的方式解决某个问题,则要在注释中解释你是如何做的.
4. Hack: 因为存在浏览器差异.

- 变量和函数命名

1. 函数名应以动词开始, getName(), 返回布尔值类型一般以`is`开头.如isEnable()
2. 变量名应为名词

- 变量类型透明

### 松散耦合

- 解耦HTML/JavaScript

HTML是数据,JavaScript是行为,

- 解耦CSS/JavaScript

- 解耦应用逻辑/事件处理程序

一个事件处理程序应该从事件对象中提取相关信息,并将这些信息传送到处理应用逻辑的某个方法中.

### 编程实践

- 尊重对象主权

> 不要为实例或原型添加属性
> 不要为实例或原型添加方法
> 不要重定义已存在的方法

- 避免全局量

最多创建一个全局变量,让其他对象和函数存在其中.

- 避免与null进行比较

必须按照所期望的对值进行检查,而非按照不明期望的那些.

```js
function sortArray(values) {
  if (values != null) { // 避免
    values.sort(comparator);
  }
}

function sortArray(values) {
  if (values instanceof Array) { // 推荐 可以阻止所有非法值,而且用不着null.
    values.sort(comparator);
  }
}
``` 

如果看到了与null比较的代码,尝试用以下技术替换:

1. 值是一个引用类型,使用`instanceof`操作符检查其构造函数
2. 值应该是一个基本类型, 使用`typeof`检查其类型
3. 如果是希望对象包含某个特定的方法名,则使用`typeof`操作符确保指定名字的方法存在于对象上.

- 使用常量

将数据和使用它的逻辑进行分离.
1. 重复值
2. 用户界面字符串(国际化)
3. URLs:容易变更,推荐用一个公共地方存放所有的URL
4. 任意可能会更改的值.

## 性能

### 注意作用域

- 避免全局查找

使用全局变量和函数肯定要比局部的开销大,看PDF例子

- 避免with语句

with语句会创建自己的作用域,会增加其中执行代码的作用域链的长度.

### 选择正确方法

性能问题的一部分是用于解决问题的算法或者方法有关.

- 避免不必要的属性查找(算法时间)

- 优化循环

1. `减值迭代`. 大多数循环使用一个从0开始,增加到某个特定值的迭代器,很多情况下,从最大值开始,再循环中不断减值的迭代器更加高效.
2. `简化终止条件`: 避免查找属性或其他O(n)的操作.
3. `简化循环体`
4. `使用后测试循环`: 最常用`for`循环和`while`循环都是前测试循环,而如`do-while`这种后测试循环.可以避免最初终止条件的计算.

第4个例子:for 循环:

```js
// 一般
for (var i=0; i < values.length; i++) {
  process(values[i]);
}

// 第1,2种:将终止条件从values.length的O(n)调用简化成了0的O(1)调用
for (var i=values.length - 1; i >= 0; i--) {
  process(values[i]);
}

// 第4种
var i = values.length - 1;
if (i > -1) {
  do {
    process(values[i]);
  } while(--i >= 0)
}
```

使用`后测试`循环时必须确保要处理的值至少有一个.空数组会导致多余的一次循环,而`前测试`循环可以避免.

- 展开循环

循环次数确定,消除循环并使用多次函数调用往往更快.循环的迭代次数不能事先确定,可以考虑一种叫做`Duff`装置技术.看PDF

- 避免双重解释

- 性能的其他注意事项

1. 原生方法较快.
2. Switch语句较快:有一些复杂的if-else语句,可以转化为单个switch语句
3. 位运算符较快:进行数学运算的时候,位运算操作要比任何布尔值或者数学运算快.如:`取模`,`逻辑与`和`逻辑或`.

### 最小化语句数

- 多个变量声明:
```js
var count = 5,
    color = 'blue',
   values = [1,2,3],
      now =  new Date();
```

- 插入迭代值

- 使用数组和对象字面量

### 优化DOM交互

- 最小化现场更新

使用文档碎片来构建DOM结构,在添加到页面上.

- 使用innerHTML

- 使用事件代理

- 注意HTMLCollection

## 部署

### 构建过程

1. 知识产权问题
2. 文件大小
3. 代码组织

### 验证

JSLint验证(查看PDF)

### 压缩

1. 文件压缩
2. HTTP压缩



-----------------------

> 参考文档: [JavaScript高级程序设计（第三版）](http://www.ituring.com.cn/book/946)
> 文章若有纰漏，请大家补充指正.
> 仅作为学习交流所用,不与商用.违者必究.
> [转载请注明出处: http://blog.uijack.com/](http://blog.uijack.com/)
